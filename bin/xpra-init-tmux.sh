#! /bin/sh
sessname="xpra-${DISPLAY#:}"
didexist=0
tmux new -ds "$sessname" || didexist=1
tmux set-option -t "$sessname" update-environment ''
for i in CKCON_X11_DISPLAY DBUS_SESSION_BUS_ADDRESS DBUS_SESSION_BUS_PID DESKTOP_SESSION DISABLE_IMSETTINGS DISPLAY GDK_BACKEND GDK_DPI_SCALE GDK_SCALE GDMSESSION GTK_CSD GTK_IM_MODULE IMSETTINGS_MODULE MWNOCAPTURE MWNO_RIT MWWM NO_AT_BRIDGE PATH PULSE_SERVER QT4_IM_MODULE QT_IM_MODULE QT_QPA_PLATFORM QT_SCALE_FACTOR QT_X11_NO_NATIVE_MENUBAR UBUNTU_MENUPROXY WINDOWID XDG_CURRENT_DESKTOP XDG_SEAT XDG_SESSION_DESKTOP XDG_SESSION_ID XDG_SESSION_TYPE XDG_VTNR XMODIFIERS XPRA_LOG_DIR XPRA_PULSE_SERVER XPRA_PULSE_SINK_DEVICE_NAME XPRA_PULSE_SOURCE_DEVICE_NAME XPRA_SERVER_LOG XPRA_SERVER_SOCKET
do \
	tmux set-environment -t "$sessname" "$i" "$(eval "printf '%s' \"\$$i\"")"
done
if [ "$didexist" = 0 ]; then \
	tmux respawn-window -k -t "$sessname:^"
fi
